# AI 全栈项目

## PostgreSQL

PostgreSQL是一款顶级开源关系型数据库，以功能强大、稳定可靠著称。它完美支持事务与复杂SQL查询，并具备卓越的可扩展性。除传统表结构外，还支持JSON和地理空间数据，被誉为“最先进的开源数据库”，是处理核心业务和复杂数据的首选方案。

关系型数据库是一种以 ** 二维表格（行 / 列）** 组织存储数据，通过主键、外键建立表格间逻辑关联，遵循 ACID 事务特性保证数据一致性和可靠性的数据库

A（Atomicity，原子性） 要么全部成功，要么全部失败回滚
示例：转账事务包含 “扣减 A 的 100 元” 和 “增加 B 的 100 元” 两步，要么两步都完成，要么任意一步失败时，已执行的步骤全部回滚（A 的钱不扣，B 的钱不加）。

C（Consistency，一致性）：事务执行前后，数据库的整体数据约束和业务规则保持不变（数据处于合法状态）。
示例：转账前 A+B 的总余额是 1000 元，转账后总余额依然是 1000 元，不会出现 “扣了 A 的钱但 B 没收到”（总余额减少）或 “没扣 A 的钱但 B 收到了”（总余额增加）的非法状态。

I（Isolation，隔离性）：多个并发执行的事务之间相互独立、互不干扰，每个事务都感觉不到其他事务在同时执行。
示例：如果同时有两笔事务（A 转 B100 元、C 转 B200 元），不会出现因并发操作导致的 B 最终到账金额错误，两个事务的执行结果互不影响。

D（Durability，持久性）：事务一旦提交成功，对数据的修改就永久生效且不可逆转，即使后续发生数据库崩溃、服务器断电等故障，修改结果也不会丢失。
示例：转账事务提交成功后，A 的余额减少 100、B 的余额增加 100 的结果会被永久保存，就算数据库服务器立刻断电重启，该结果依然存在。

### 安装

- https://www.postgresql.org/download/windows/
- sudo -u postgres psql  密码123456

### 数据库操作
- \list
显示所有数据库
- 创建数据库
CREATE DATABASE xb
WITH OWNER = postgres    /*最高权限 */
ENCODING = 'UTF8';
- 进入xb2
\c xb2
- prompt 生成数据表
```
你是一位psql 高级工程师， 需要建一个user 表， 包含id, name, password 三个字段。id 自增， 主键， name 不能重复， 请给出建表sql
```
CREATE TABLE users (
    -- 使用 BIGINT 避免未来数据量过大导致 ID 溢出，IDENTITY 是 SQL 标准自增方式
    -- INT（上限21亿) BIGINT（8字节）
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    
    -- UNIQUE 约束会自动创建索引，NOT NULL 保证数据完整性
    name VARCHAR(255) NOT NULL UNIQUE,
    
    -- 密码字段，通常长度设为 255 以适配各种哈希加密算法（如 bcrypt）
    password VARCHAR(255) NOT NULL,
    
    -- 高级工程师通常会增加这两个审计字段
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

- 显示表
\dt
\d users

- 主键、唯一索引
  数据库索引就像字典前面的索引页，通过关键词快速定位到具体内容位置，避免逐条翻查数据，大幅提升查询效率，但会增加一定的存储和维护成本。
  快、也不能乱加
  主键用于唯一标识一条数据记录，保证数据不重复、可快速定位查询结果，同时作为表之间建立关联的依据，确保数据一致性和完整性。
  唯一索引用于保证某一列或多列数据不重复，在提升查询效率的同时，从数据库层面约束数据唯一性，避免出现脏数据或业务逻辑错误。
  掘金不可能有两个白兰地空瓶

- seeds
  ```
  INSERT INTO "users" ("id", "name", "password") VALUES
  ('1', '王皓', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('2', '小雪', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('3', '李白', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('4', '杜甫', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('5', '白居易', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('6', '张三', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq');
  ```
  select * from users;

### posts 表

你是一位psql 高级工程师， 需要建一个posts 表， 包含id, title, content,userId 三个字段。id 自增， 主键， title 不为空，不超过255个字符， content  长文本，  usersId 是bigint 类型，是 users 表的外键，请给出建表sql

CREATE TABLE posts (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT,
    "userId" BigInt NOT NULL,
    CONSTRAINT fk_posts_user FOREIGN KEY ("userId") REFERENCES users(id) ON DELETE CASCADE
);

INSERT INTO "posts" ("title", "content", "userId") VALUES 
('黄鹤楼送孟浩然之广陵', '故人西辞黄鹤楼，烟花三月下扬州', 3),
('春夜喜雨', '好雨知时节，当春乃发生', 4),
('琵琶行', '浔阳江头夜送客，枫叶荻花秋瑟瑟', 5),
('静夜思', '床前明月光，疑是地上霜', 3),
('望岳', '会当凌绝顶，一览众山小', 4),
('浪淘沙', '白浪茫茫与海连，平沙浩浩四无边', 5),
('将进酒', '君不见黄河之水天上来，奔流到海不复回', 3),
('天末怀李白', '凉风起天末，君子意如何', 4),
('花非花', '花非花，雾非雾，夜半来，天明去', 5),
('望庐山瀑布', '日照香炉生紫烟，遥看瀑布挂前川', 3),
('绝句二首', '迟日江山丽，春风花草香', 4),
('秋思', '夕照红于烧，晴空碧胜蓝', 5),
('早发白帝城', '朝辞白帝彩云间，千里江陵一日还', 3),
('龙门镇', '细泉兼轻冰，沮洳栈道湿', 4),
('采莲曲', '菱叶萦波荷飐风，荷花深处小船通', 5),
('独坐敬亭山', '众鸟高飞尽，孤云独去闲', 3),
('三绝句', '楸树馨香倚钓矶，斩新花蕊未应飞', 4),
('江南春', '青门柳枝软无力，东风吹作黄金色', 5),
('白云泉', '天平山上白云泉，云自无心水自闲', 5),
('叶子的肖像', '叶子的肖像，每张都不一样', 1),
('月下独酌', '花间一壶酒，独酌无相亲', 3),
('登楼', '花近高楼伤客心，万方多难此登临', 4),
('大明湖的荷花', '大明湖里没青蛙，大明湖里有荷花', 1),
('关山月', '明月出天山，苍茫云海间', 3);

## TypeScript 

TypeScript 是 JavaScript 的超集，在 JS 的基础上增加了「静态类型系统」，让代码在编译阶段就能发现错误。

ts-demo/1.js 是一个简单的 JS 函数，用于计算两个数字的和。
ts-demo/2.ts 是一个简单的 TS 函数，用于计算两个数字的和。

### 核心特点
  - 基于 JavaScript，JS 能跑的 TS 都能写
  - 增加类型约束，减少运行时 Bug
  - 提供更强的 IDE 提示（自动补全、重构）
  - 最终会被编译成 JavaScript 执行

### 为什么要用 TypeScript
  - JS 是弱类型，错误往往运行时才暴露
  - TS 在写代码时就报错
  - 适合中大型项目、多人协作

### 安装和编译
- npm install -g typescript@latest
- tsc ts-demo/2.ts 编译

### ts 类型系统

```
let a: number = 1
let b: string = 'hello'
let c: boolean = true
let d: null = null
let e: undefined = undefined

let arr1: number[] = [1, 2, 3]
<> 范型  指定类型参数
let arr2: Array<string> = ['a', 'b']

元组是长度固定且每个位置类型明确的有序列表，常用于存储一组不可变的相关数据。
let user: [number, string] = [1, 'Tom']

枚举（Enum）
enum Status {
  Pending,
  Success,
  Fail
}

let s: Status = Status.Success

any 与 unknown
let a: any = 1 // any 是直接丢掉所有安全检查
a.foo()

let b: unknown = 1 // unknown 比 any 更安全 表示值的类型未知
// 一种安全的顶层类型 它不允许在未经类型检查或断言的情况下进行任何操作
// b.foo() ❌
对象类型
let user: { name: string; age: number } = {
  name: 'Tom',
  age: 18
}

接口（Interface）⭐
interface User {
  name: string
  age: number
  readonly id: number
  hobby?: string
}
const u: User = {
  id: 1,
  name: 'Tom',
  age: 18
}

接口用于定义对象的结构形状，作为代码间的“契约”来强制约束数据必须具备哪些属性和方法。

类型别名（type）
type ID = string | number

type User = {
  name: string
  age: number
}
interface 更偏结构，type 更偏组合

联合类型 & 交叉类型

let id: string | number

type A = { a: number }
type B = { b: string }

type C = A & B
函数类型
function add(a: number, b: number): number {
  return a + b
}

type Add = (a: number, b: number) => number
泛型
function identity<T>(value: T): T {
  return value
}
identity<string>('hello')
identity<number>(123)

```

TypeScript 通过静态类型系统，在开发阶段提前发现问题，提升代码可维护性和大型项目的协作效率，是现代前端工程的基础能力。

## ts 实战之todos
todos-ts-demo

## mobile app

### 初始化项目

- npm init vite 
  notes react typescript 
- pnpm install zustand react-router-dom lucide-react
- tailwindcss 初始化
- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

### alias 添加
```
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});

npm install -D @types/node

{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
    // ... 其他配置
  }
}
```

### shadcn-ui 初始化

shadcn/ui 是一个基于 Radix UI 和 Tailwind CSS 的可定制 React 组件库，将组件代码直接复制到你的项目中，让你完全掌控样式和逻辑；其核心优势是：零黑盒、高度可定制、自动集成 Tailwind、类型安全、且只引入所需组件，无冗余依赖。

- npx shadcn@latest init
- npx shadcn@latest add button
- App.tsx 中引入 Button 组件
- npx shadcn@latest  add input card form label

### 自定义组件
- Header 组件
- 幻灯片组件
  - npx shadcn@latest add carousel
  - pnpm i embla-carousel-autoplay
  - components/SlideShow.tsx
- BackToTop 组件  节流

### mockjs 模拟数据
Mock.js 能在后端接口未完成时，快速生成模拟数据，让前端独立开发、调试和演示，提升协作效率。
- vite.config.ts 配置
- pnpm i mockjs @types/mockjs
- mock/post.js 

### 注册页面
- pnpm i axios
- register
- api/auth.ts

## zustand

Zustand 是一个轻量、简洁的 React 状态管理库，基于 hooks 实现，无需 Provider 即可管理全局状态。

- zustand-demo

## router 升级
  react/basic/router

## antd-design
Ant Design（简称 antd）是基于 React 开发的企业级 UI 组件库，提供丰富易用的组件与设计规范，助力中后台产品快速构建。

https://ant.design/

### 安装


## nest.js
express 是一个基于 Node.js 的 Web 应用框架，它提供了一组简单、灵活的 API，用于构建 Web 应用和 API。

Nest.js 是一个基于 TypeScript 的进阶版 Node.js 框架，它采用模块化架构和依赖注入设计，旨在构建高效、可扩展且易于维护的企业级后端应用。

### 新建项目

- 安装与创建项目（推荐方式）
```
npm i -g @nestjs/cli
nest new nest-test-demo  # 创建项目
cd nest-test-demo
npm run start:dev     # 启动服务
```

### 介绍下nest.js 的项目结构

NestJS 采用模块化分层架构，main.ts 作为应用入口启动服务，AppModule 负责组织模块；Controller 处理请求与路由，Service 封装业务逻辑，spec.ts 用于单元测试。整体遵循依赖注入思想，结构清晰，适合构建可维护、可扩展的后端应用。

### todos模块
- todos 目录 app.module.ts

### 准备
- 允许跨域
```
app.enableCors({
    origin: 'http://localhost:3000', // 允许的前端地址
    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',
    credentials: true,               // 允许携带 cookie
});
```
- 链接数据库
  ```
  // src/database.module.ts
import { Module, Global } from '@nestjs/common';
import { Pool } from 'pg';
import * as dotenv from 'dotenv';

// 加载 .env 文件（仅在非生产环境或未通过其他方式注入环境变量时需要）
dotenv.config();

@Global()
@Module({
  providers: [
    {
      provide: 'PG_CONNECTION',
      useValue: new Pool({
        user: process.env.DB_USER,
        host: process.env.DB_HOST,
        database: process.env.DB_NAME,
        password: process.env.DB_PASSWORD,
        port: parseInt(process.env.DB_PORT || '5432', 10),
      }),
    },
  ],
  exports: ['PG_CONNECTION'],
})
export class DatabaseModule {}
  ```
  - app.controller.ts
  ```
  // src/app.module.ts
import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { TodosModule } from './todos/todos.module';
import { DatabaseModule } from './database.module';

@Module({
  imports: [TodosModule, DatabaseModule], // 👈 引入 todos 功能模块
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}

  ```

## prisma
给 Node.js 用的数据库操作神器，不用手写 SQL，直接调用api 就好。


### 登录，注册功能
- next.js 注册

## AI 功能
### RAG
- 向量化 embedding-demo