[source](https://juejin.cn/post/6844903767226351623?searchId=2025080520253975962DFB4836B4194BDA)

- 什么是跨域
 demo
- CORS policy
  同源策略是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSRF等攻击。所谓同源是指"协议+域名+端口"三者相同，即便两个不同的域名指向同一个ip地址，也非同源。

  ![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/5/23/1638b3579d9eeb32~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp)

- 同源策略限制内容有
  Cookie、LocalStorage、IndexedDB 等存储性内容
  DOM 节点
  AJAX/fetch 请求发送后，结果被浏览器拦截了

- 三个标签是允许跨域加载资源：
  <img src=XXX>
  <link href=XXX>
  <script src=XXX>

- 如果是协议和端口造成的跨域问题“前台”是无能为力的。
  请求跨域了，那么请求到底发出去没有？

  跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了。

  同源策略并不会阻止浏览器发送跨域请求，而是限制了对响应结果的访问。当使用 fetch 或 XMLHttpRequest 发起跨域请求时，请求本身可以正常发送到服务器，后端也能收到并处理，返回响应。但浏览器会检查响应头中是否包含合法的 Access-Control-Allow-Origin 等 CORS 相关字段。如果缺少或不匹配，浏览器将拦截响应数据，不允许前端 JavaScript 读取，从而在控制台报跨域错误。因此，请求“发出去了”，但响应被浏览器“拦下来了”，这就是 CORS 的核心机制。它是一种安全策略，防止恶意站点读取其他源的敏感数据，而不是完全禁止通信。

- jsonp
  利用 <script> 标签没有跨域限制的漏洞，网页可以得到从其他来源动态产生的 JSON 数据。JSONP请求一定需要对方的服务器做支持才可以。

  2) JSONP和AJAX对比
  JSONP和AJAX相同，都是客户端向服务器端发送请求，从服务器端获取数据的方式。但AJAX属于同源策略，JSONP属于非同源策略（跨域请求）

  3) JSONP优缺点
  JSONP优点是简单兼容性好，可用于解决主流浏览器的跨域数据访问的问题。缺点是仅支持get方法具有局限性,不安全可能会遭受XSS攻击。

  4) 实现流程
  声明一个回调函数，其函数名(如show)当做参数值，要传递给跨域请求数据的服务器，函数形参为要获取目标数据(服务器返回的data)。
创建一个<script>标签，把那个跨域的API数据接口地址，赋值给script的src,还要在这个地址中向服务器传递该函数名（可以通过问号传参:?callback=show）。
服务器接收到请求后，需要进行特殊的处理：把传递进来的函数名和它需要给你的数据拼接成一个字符串,例如：传递进去的函数名是show，它准备好的数据是show('我不爱你')。
最后服务器把准备的数据通过HTTP协议返回给客户端，客户端再调用执行之前声明的回调函数（show），对返回的数据进行操作。

- 2.cors
CORS 需要浏览器和后端同时支持。

浏览器会自动进行 CORS 通信，实现 CORS 通信的关键是后端。只要后端实现了 CORS，就实现了跨域。
服务端设置 Access-Control-Allow-Origin 就可以开启 CORS。 该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。
虽然设置 CORS 和前端没什么关系，但是通过这种方式解决跨域问题的话，会在发送请求时出现两种情况，分别为简单请求和复杂请求。

1) 简单请求
只要同时满足以下两大条件，就属于简单请求
条件1：使用下列方法之一：

GET
HEAD
POST

条件2：Content-Type 的值仅限于下列三者之一：

text/plain
multipart/form-data
application/x-www-form-urlencoded


2)  复杂请求
不符合以上条件的请求就肯定是复杂请求了。 复杂请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为"预检"请求,该请求是 option 方法的，通过该请求来知道服务端是否允许跨域请求。

