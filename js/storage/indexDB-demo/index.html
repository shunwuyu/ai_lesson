<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç¦»çº¿ä»»åŠ¡åˆ—è¡¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background-color: #f7f7f7;
    }

    h1 {
      text-align: center;
    }

    form {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: white;
      padding: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .delete-btn {
      background: #ef4444;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ğŸ“‹ ç¦»çº¿ä»»åŠ¡åˆ—è¡¨</h1>

  <form id="taskForm">
    <input type="text" id="taskInput" placeholder="è¾“å…¥ä»»åŠ¡..." required />
    <button type="submit">æ·»åŠ </button>
  </form>

  <ul id="taskList"></ul>

  <script>
    let db;
    // åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ª IndexedDB æ•°æ®åº“
    // æ•°æ®åº“ç‰ˆæœ¬å·
    // è‹¥è¦ä¿®æ”¹æ•°æ®åº“ç»“æ„ï¼ˆå¦‚åˆ›å»ºæˆ–åˆ é™¤å¯¹è±¡å­˜å‚¨ç©ºé—´ï¼‰ï¼Œåˆ™è¦æå‡ç‰ˆæœ¬å·
    const request = indexedDB.open("todoDB", 1);
    // å½“æ•°æ®åº“åˆ›å»ºæˆ–ç‰ˆæœ¬å‡çº§æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œå¸¸ç”¨æ¥åˆå§‹åŒ–æ•°æ®åº“ç»“æ„
    request.onupgradeneeded = function (event) {
      db = event.target.result;
      // åˆ›å»ºä¸€ä¸ªåä¸º tasks çš„å¯¹è±¡å­˜å‚¨åŒºï¼ˆç±»ä¼¼å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼‰ï¼Œ
      // æŒ‡å®š id ä½œä¸ºé”®è·¯å¾„ï¼Œå¹¶è®¾ç½®é”®å€¼è‡ªåŠ¨é€’å¢ã€‚
      const objectStore = db.createObjectStore("tasks", {
        keyPath: "id",
        autoIncrement: true
      });
      // å¯¹è±¡å­˜å‚¨åŒºçš„ title å­—æ®µåˆ›å»ºä¸€ä¸ªéå”¯ä¸€ç´¢å¼•ï¼Œæ–¹ä¾¿åç»­æ ¹æ® title å­—æ®µè¿›è¡ŒæŸ¥è¯¢
      objectStore.createIndex("title", "title", { unique: false });
    };
    // å½“æ•°æ®åº“æˆåŠŸæ‰“å¼€æ—¶è§¦å‘ã€‚
    request.onsuccess = function (event) {
      db = event.target.result;
      console.log("âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ");
      renderTasks();
    };
    // æ‰“å¼€å¤±è´¥
    request.onerror = function () {
      console.error("âŒ æ•°æ®åº“è¿æ¥å¤±è´¥");
    };

    function addTask(title) {
      // ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§
      // åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„äº‹åŠ¡
      // åœ¨ IndexedDB é‡Œï¼Œæ‰€æœ‰çš„æ•°æ®æ“ä½œï¼ˆå¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼‰éƒ½å¿…é¡»åœ¨äº‹åŠ¡ä¸­å®Œæˆ
      const transaction = db.transaction(["tasks"], "readwrite");
      const store = transaction.objectStore("tasks");
      const task = {
        title,
        done: false,
        createdAt: new Date()
      };
      const request = store.add(task);
      request.onsuccess = renderTasks;
    }

    function deleteTask(id) {
      const transaction = db.transaction(["tasks"], "readwrite");
      const store = transaction.objectStore("tasks");
      const request = store.delete(id);
      request.onsuccess = renderTasks;
    }

    function renderTasks() {
      const transaction = db.transaction(["tasks"], "readonly");
      const store = transaction.objectStore("tasks");
      const request = store.getAll();

      request.onsuccess = function () {
        const tasks = request.result;
        const taskList = document.getElementById("taskList");
        taskList.innerHTML = "";

        tasks.forEach(task => {
          const li = document.createElement("li");
          li.textContent = task.title;

          const btn = document.createElement("button");
          btn.textContent = "åˆ é™¤";
          btn.className = "delete-btn";
          btn.onclick = () => deleteTask(task.id);

          li.appendChild(btn);
          taskList.appendChild(li);
        });
      };
    }

    // è¡¨å•æäº¤å¤„ç†
    document.getElementById("taskForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const input = document.getElementById("taskInput");
      const title = input.value.trim();
      if (title) {
        addTask(title);
        input.value = "";
      }
    });
  </script>
</body>
</html>
