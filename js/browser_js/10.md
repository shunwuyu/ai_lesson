# 作用域链和闭包 ：代码中出现相同的变量，JavaScript引擎是如何选择的？

- 看代码 10/1.js
    结果是？ 极客时间
    画图
- 变量环境和词法环境支持了变量提升和块级作用域

## 作用域链
基于 调用栈、执行上下文、词法环境、变量环境
作用域链好理解。

其实在每个执行上下文的变量环境中，都包含了一个外部引用，用来指向外部的执行上下文，我们把这个外部引用称为 outer。

当一段代码使用了一个变量时，JavaScript 引擎首先会在“当前的执行上下文”中查找该变量，

比如上面那段代码在查找 myName 变量时，如果在当前的变量环境中没有查找到，那么 JavaScript 引擎会继续在 outer 所指向的执行上下文中查找

看图 https://static001.geekbang.org/resource/image/20/a7/20a832656434264db47c93e657e346a7.png?wh=1142*797

我们把这个查找的链条就称为作用域链。

为何bar 函数的外部引用是全局执行上下文，而不是 foo 函数的执行上下文？

**词法作用域**

词法作用域就是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能够预测代码在执行过程中如何查找标识符。

看图https://static001.geekbang.org/resource/image/21/39/216433d2d0c64149a731d84ba1a07739.png?wh=1142*864

词法作用域链

所以整个词法作用域链的顺序是：foo 函数作用域—>bar 函数作用域—>main 函数作用域—> 全局作用域。

词法作用域是代码编译阶段就决定好的，和函数是怎么调用的没有关系。

作用域链是变量查找路径，词法作用域链基于代码书写位置决定作用域层级。

词法作用域决定作用域链的结构，作用域链是在运行时按这个结构查找变量的机制，两者是协同关系。

块级作用域中的变量查找

## 闭包
10/3.js

在 JavaScript 中，根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使该外部函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们就把这些变量的集合称为闭包。比如外部函数是 foo，那么这些变量的集合就称为 foo 函数的闭包。

加断点调试

## 闭包是怎么回收的
