# 块级作用域

- 说说 var的缺陷
  1.js
  JavaScript 中变量提升的相关内容，正是由于 JavaScript 存在变量提升这种特性，从而导致了很多与直觉不符的代码，这也是 JavaScript 的一个重要设计缺陷。

- 一国两制
  ES6 let、const 暂时性死区 避免变量提升
  同时还提到 块级作用域？
  JavaScript 需要保持向下兼容，所以变量提升在相当长一段时间内还会继续存在

  因为既要理解新的机制，又要理解变量提升这套机制，关键这两套机制还是同时运行在“一套”系统中的。

- 为什么 JavaScript 中会存在变量提升这个特性，而其他语言似乎都没有这个特性呢？
  从作用域讲起。

- 作用域
  作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗地理解，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。
  在 ES6 之前，ES 的作用域只有两种：全局作用域和函数作用域。

  作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗地理解，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。
2.js 

  全局作用域中的对象在代码中的任何地方都能访问，其生命周期伴随着页面的生命周期。

  数作用域就是在函数内部定义的变量或者函数，并且定义的变量或者函数只能在函数内部被访问。函数执行结束之后，函数内部定义的变量会被销毁。

  ES6 之前，JavaScript 只支持这两种作用域，相较而言，其他语言则都普遍支持块级作用域

  块级作用域就是使用一对大括号包裹的一段代码，比如函数、判断语句、循环语句，甚至单独的一个{}都可以被看作是一个块级作用域。

  3.js

  如果一种语言支持块级作用域，那么其代码块内部定义的变量在代码块外部是访问不到的，并且等该代码块中的代码执行完成之后，代码块中定义的变量会被销毁
  4.js

  变量提升产生原因
  ES6 之前是不支持块级作用域的，因为当初设计这门语言的时候，并没有想到 JavaScript 会火起来，所以只是按照最简单的方式来设计。没有了块级作用域，再把作用域内部的变量统一提升无疑是最快速、最简单的设计，不过这也直接导致了函数中的变量无论是在哪里声明的，在编译阶段都会被提取到执行上下文的变量环境中，所以这些变量在整个函数体内部的任何地方都是能被访问的，这也就是 JavaScript 中的变量提升。

## 变量提升所带来的问题

- 1. 变量容易在不被察觉的情况下被覆盖掉
5.js
  ![](https://static001.geekbang.org/resource/image/94/c9/944aaeaeb9ee50feea3c7d218acdd5c9.png?wh=1142*710)

- 2. 本应销毁的变量没有被销毁
  6.js

  如果你使用 C 语言或者其他的大部分语言实现类似代码，在 for 循环结束之后，i 就已经被销毁了，但是在 JavaScript 代码中，i 的值并未被销毁，所以最后打印出来的是 7。

## ES6 是如何解决变量提升带来的缺陷?
ES6 引入了 let 和 const 关键字, 从而使 JavaScript 也能像其他语言一样拥有了块级作用域。

```
let x = 5
const y = 6
x = 7
y = 9 //报错，const声明的变量不可以修改
```
- 变量提升的代码
![](https://static001.geekbang.org/resource/image/45/bf/4501368679083f3a8e1a9e4a8e316dbf.png?wh=1142*513)

## JavaScript 是如何支持块级作用域的

在同一段代码中，ES6 是如何做到既要支持变量提升的特性，又要支持块级作用域的呢？

站在执行上下文的角度

```
function foo(){
    var a = 1
    let b = 2
    {
      let b = 3
      var c = 4
      let d = 5
      console.log(a)
      console.log(b)
    }
    console.log(b) 
    console.log(c)
    console.log(d)
}   
foo()
```

在词法环境内部，维护了一个小型栈结

栈底是函数最外层的变量，进入一个作用域块后，就会把该作用域块内部的变量压到栈顶；当作用域执行完成之后，该作用域的信息就会从栈顶弹出，这就是词法环境的结构。

let myname= '极客时间'
{
  console.log(myname) 
  let myname= '极客邦'
}